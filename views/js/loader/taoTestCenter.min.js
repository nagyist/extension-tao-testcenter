define("tpl!taoTestCenter/component/proctorForm/form",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var buffer="";return buffer+='<div class="proctor-form section-container">\n    <div class="content-block">\n        ',!(helpers=(Handlebars=(helpers=this.merge(helpers,Handlebars.helpers)).form)||"function"==typeof(Handlebars=depth0&&depth0.form)?Handlebars.call(depth0,{hash:{},data:data}):Handlebars)&&0!==helpers||(buffer+=helpers),buffer+="\n    </div>\n</div>"})}),define("taoTestCenter/component/proctorForm",["lodash","jquery","i18n","helpers","users",
"ui/feedback","ui/component","taoProctoring/helper/textConverter","tpl!taoTestCenter/component/proctorForm/form"],function(_,$,__,helpers,users,feedback,component,textConverter,formTpl){"use strict";var _ns=".proctor-form",proctorFormUrl=helpers._url("createProctorForm","ProctorManager","taoTestCenter"),proctorLoginCheckUrl=helpers._url("checkLogin","ProctorManager","taoTestCenter");function renderFormFromData($container,formData){$container.html(formTpl({form:formData.form})),users.checkLogin(formData.loginId,proctorLoginCheckUrl)}return helpers.init(),function(config){return component().on("destroy",function(){this.getElement().off(_ns).empty()}).on(
"render",function(){var self=this,$element=this.getElement();textConverter().then(function(labels){$.get(proctorFormUrl,function(formData){renderFormFromData($element,formData),$element.on("submit"+_ns,"form",function(e){var fields=$(this).serializeArray(),list=self.config.testCenterList,data={testCenters:list&&list.getSelection()};_.each(fields,function(field){data[field.name]=field.value}),$.post(proctorFormUrl,data,function(res){res.created?(feedback().success(labels.get("Proctor created")),self.destroy()):renderFormFromData($element,res)}),e.preventDefault()}).on("click","button.btn-diasble",function(){self.destroy()})})}).catch(function(err){
console.log(err)})}).init(config)}}),define("tpl!taoTestCenter/templates/proctorManager/counters",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers);var functionType="function",escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var stack1,helper,buffer="";return buffer+='<div class="',stack1=(helper=helpers.cls)||typeof(helper=depth0&&depth0.cls)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'"><span class="text">',stack1=(helper=helpers.label)||typeof(
helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</span>: <span class="count">',stack1=(helper=helpers.count)||typeof(helper=depth0&&depth0.count)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span></div>"}return(Handlebars=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var buffer="";return buffer+="\n    ",!(depth0=helpers.if.call(depth0,depth0&&depth0.count,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}))&&0!==depth0||(buffer+=depth0),buffer+="\n"},
data=data||{}),data:data}))||0===Handlebars?Handlebars:""})}),define("tpl!taoTestCenter/templates/proctorManager/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];var buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,functionType="function";return!(Handlebars=helpers.if.call(depth0,depth0&&depth0.authorized,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var helper,buffer="";return buffer+=escapeExpression((data={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__
)?helper.call(depth0,"Authorized",data):helperMissing.call(depth0,"__","Authorized",data)))+' <span class="icon icon-authorize"></span>'},data=data||{}),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer+="\n",!(Handlebars=helpers.if.call(depth0,depth0&&depth0.partially,{hash:{},inverse:this.noop,fn:this.program(3,function(depth0,data){var helper,stack1,buffer="";return buffer+='<span title="',stack1=(helper=helpers.testCenters)||typeof(helper=depth0&&depth0.testCenters)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">'+escapeExpression((stack1={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__
)?helper.call(depth0,"Partially authorized",stack1):helperMissing.call(depth0,"__","Partially authorized",stack1)))+"</span>"},data),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer})}),define("taoTestCenter/controller/ProctorManager/index",["lodash","jquery","i18n","layout/loading-bar","util/url","util/encode","ui/feedback","ui/dialog/confirm","ui/bulkActionPopup","ui/datalist","ui/button","taoTestCenter/component/proctorForm","taoProctoring/helper/textConverter","tpl!taoTestCenter/templates/proctorManager/counters","tpl!taoTestCenter/templates/proctorManager/status","ui/datatable"],function(_,$,__,loadingBar,urlHelper,encode,feedback,dialogConfirm
,bulkActionPopup,datalist,buttonFactory,proctorForm,textConverter,counterTpl,statusTpl){"use strict";var indexUrl=urlHelper.route("index","TestCenter","taoTestCenter"),proctorsDataUrl=urlHelper.route("proctorAuthorizations","ProctorManager","taoTestCenter"),authorizeUrl=urlHelper.route("authorize","ProctorManager","taoTestCenter"),unauthorizeUrl=urlHelper.route("unauthorize","ProctorManager","taoTestCenter"),_modes_EMPTY=0,_modes_LIST=1,_modes_FORM=2;return loadingBar.start(),{start:function(){textConverter().then(function(labels){var $container=$(".proctorManager-index"),$panelSelection=$(".test-center-panel"),$containerList=$(".proctor-list"),
$containerForm=$(".proctor-create"),$noSelection=$(".proctor-default"),testCenters=$container.data("list"),pageMode=_modes_EMPTY,list=datalist({renderTo:$panelSelection,textNumber:__("Test sites"),labelText:__("Test site"),selectable:!0},testCenters);function request(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testCenters:list.getSelection(),proctors:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){var errorMessage;loadingBar.stop(),response&&response.success?(message&&feedback().success(message),$containerList.datatable("refresh")):(errorMessage=__(
"Something went wrong ..."),response.proctors&&(errorMessage=__("No authorization to revoke for these proctors :"),errorMessage+="</ul>",response.proctors.forEach(function(proctor){errorMessage+="<li>"+proctor+"</li>"}),errorMessage+="</ul>"),feedback().error(errorMessage,{encodeHtml:!1}))}))}function authorize(selection,message){dialogConfirm(message,function(){request(authorizeUrl,selection,labels.get("Proctors authorized"))})}function revoke(selection,message){dialogConfirm(message,function(){request(unauthorizeUrl,selection,labels.get("Proctors revoked"))})}function processMode(selection){if(selection.length)switch(pageMode){case _modes_EMPTY:
pageMode=_modes_LIST;case _modes_LIST:$containerList.datatable("options",{params:{testCenters:null}}).datatable("options",{params:{testCenters:selection}}).datatable("refresh")}else _modes_LIST===pageMode?pageMode=_modes_EMPTY:_modes_EMPTY!==pageMode&&feedback().warning(__("You must select at least one test center!"));$noSelection.toggleClass("hidden",_modes_EMPTY!==pageMode),$containerList.toggleClass("hidden",_modes_LIST!==pageMode),$containerForm.toggleClass("hidden",_modes_FORM!==pageMode)}buttonFactory({id:"back",type:"info",label:__("Back to index"),cls:"back-button",renderTo:$container.find(".header")}).on("click",function(){
window.location.href=indexUrl}),list.on("select",function(selection){processMode(selection)}),$containerList.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(e,dataset){var partially=0,authorized=0,dataset=dataset&&dataset.data;_.forEach(dataset,function(line){if(line&&line.status)switch(line.status){case 1:partially++;break;case 2:authorized++}}),$(this).find(".datatable-wrapper h2").append(counterTpl([{id:"authorized-list",label:labels.get("Authorized proctors"),count:authorized},{id:"partially-list",label:labels.get("Partially authorized proctors"),count:partially}])),loadingBar.stop()}).datatable({url:proctorsDataUrl,
status:{empty:labels.get("No assigned proctors"),available:labels.get("Assigned proctors"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$containerList.datatable("refresh")}},{id:"create",icon:"add",title:labels.get("Creates and authorizes proctor"),label:labels.get("Create Proctor"),action:function(){var selection=list.getSelection();proctorForm({renderTo:$containerForm,testCenterList:list}).on("destroy",function(){pageMode=_modes_LIST,processMode(list.getSelection())}),pageMode=_modes_FORM,processMode(selection)}},{id:"authorize",icon:"authorize",title:labels.get(
"Authorize the selected proctors"),label:__("Authorize"),massAction:!0,action:function(selection){authorize(selection,labels.get("The proctors will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",title:labels.get("Revoke authorization for the selected proctors"),label:__("Revoke"),massAction:!0,action:function(selection){revoke(selection,labels.get("The proctors will be revoked. Continue ?"))}}],actions:[{id:"authorize",icon:"authorize",title:labels.get("Authorize the proctor"),hidden:function(){return 2===this.status},action:function(id){authorize([id],labels.get("The proctor will be authorized. Continue ?"))}},{id:"revoke",icon:"revoke",
title:labels.get("Revoke the proctor"),hidden:function(){return!this.status},action:function(id){revoke([id],labels.get("The proctor will be revoked. Continue ?"))}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"login",label:__("Login")},{id:"state",label:__("Status"),transform:function(value,row){return statusTpl({testCenters:row.authorized,partially:1===row.status,authorized:2===row.status})}}]},[]),loadingBar.stop()}).catch(function(err){console.error(err)})}}}),define("taoTestCenter/controller/routes",{ProctorManager:{actions:{index:"controller/ProctorManager/index"}},TestCenterManager:{actions:{
editCenter:"controller/TestCenterManager/editCenter"}},TestCenter:{actions:{index:"controller/TestCenter/index",testCenter:"controller/TestCenter/testCenter"}}}),define("taoTestCenter/controller/TestCenter/index",["jquery","i18n","util/url","layout/loading-bar","ui/listbox","ui/button","taoProctoring/helper/textConverter"],function($,__,urlHelper,loadingBar,listBox,buttonFactory,textConverter){"use strict";return loadingBar.start(),{start:function(){textConverter().then(function(labels){function update(boxes){list.update(boxes),loadingBar.stop()}var $container=$(".testcenters-index"),admin=$container.data("administrator"),boxes=$container.data("list"),
list=listBox({title:__("My Test sites"),textEmpty:__("No test site available"),textNumber:__("Available"),textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0}),serviceUrl=urlHelper.route("index","TestCenter","taoTestCenter"),adminUrl=urlHelper.route("index","ProctorManager","taoTestCenter");boxes?update(boxes):(loadingBar.start(),list.setLoading(!0),$.ajax({url:serviceUrl,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)})),admin&&buttonFactory({id:"manage-proctors",type:"info",icon:"users",cls:"manage-button",label:labels.get("Manage Proctors"),renderTo:$container.find(".header")}
).on("click",function(){window.location.href=adminUrl})}).catch(function(err){console.log(err)})}}}),define("taoTestCenter/controller/TestCenter/testCenter",["jquery","i18n","util/url","layout/loading-bar","ui/listbox"],function($,__,urlHelper,loadingBar,listBox){"use strict";return loadingBar.start(),{start:function(){function update(boxes){list.update(boxes),loadingBar.stop()}var $container=$(".testcenters-testcenter"),boxes=$container.data("list"),title=($container.data("id"),$container.data("title")),list=listBox({title:title,textEmpty:!1,textNumber:!1,textLoading:__("Loading"),renderTo:$container.find(".content"),replace:!0,width:12}),
title=urlHelper.route("testCenter","TestCenter","taoTestCenter");boxes?update(boxes):(loadingBar.start(),list.setLoading(!0),$.ajax({url:title,cache:!1,dataType:"json",type:"GET"}).done(function(response){boxes=response&&response.list,update(boxes)}))}}}),define("tpl!taoTestCenter/component/eligibilityEditor/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];var helper,options,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,functionType="function";function program3(depth0,data){
return"flex-col-12"}function program5(depth0,data){return"flex-col-6"}return buffer+='<div class="eligibility-editor',!(Handlebars=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){return" editing"},data=data||{}),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer+='">\n    <h2 class="title">',Handlebars=(helper=helpers.title)||typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(Handlebars)+'</h2>\n\n    <div class="flex-grid ">\n        <div class="',!(Handlebars=helpers.if.call(depth0,depth0&&depth0.editingMode,{
hash:{},inverse:this.program(5,program5,data),fn:this.program(3,program3,data),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer+=' tree-container eligible-delivery">\n            <label>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Eligible Deliveries",options):helperMissing.call(depth0,"__","Eligible Deliveries",options)))+'</label>\n                <div id="',Handlebars=(helper=helpers.deliveryTreeId)||typeof(helper=depth0&&depth0.deliveryTreeId)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(Handlebars
)+'"></div>\n        </div>\n        <div class="',!(Handlebars=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.program(5,program5,data),fn:this.program(3,program3,data),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer+=' tree-container eligible-testTaker">\n            <label>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Eligible Test Takers",options):helperMissing.call(depth0,"__","Eligible Test Takers",options)))+" ",!(Handlebars=helpers.if.call(depth0,depth0&&depth0.editingMode,{hash:{},inverse:this.noop,fn:this.program(7,function(depth0,data){var helper,options
,buffer="";return buffer+=escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"for",options):helperMissing.call(depth0,"__","for",options)))+' <span class="delivery-name">',options=(helper=helpers.deliveryName)||typeof(helper=depth0&&depth0.deliveryName)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(options)+"</span> :"},data),data:data}))&&0!==Handlebars||(buffer+=Handlebars),buffer+='</label>\n                <div id="',Handlebars=(helper=helpers.subjectTreeId)||typeof(helper=depth0&&depth0.subjectTreeId)===functionType?helper.call(depth0,{hash:{},data:data}
):helper,buffer+=escapeExpression(Handlebars)+'"></div>\n        </div>\n    </div>\n    <div class="actions">\n        <button class="btn btn-info small done">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+'</button>\n        <a href="#" class="btn cancel" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel the action",options):helperMissing.call(depth0,"__","cancel the action",options)))+'">'+escapeExpression((options={hash:{},data:data},(
helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel",options):helperMissing.call(depth0,"__","cancel",options)))+"</a>\n    </div>\n</div>"})}),define("css!taoTestCenterCss/eligibilityEditor",[],function(){}),define("taoTestCenter/component/eligibilityEditor",["jquery","lodash","i18n","module","util/url","uri","ui/component","generis.tree.select","tpl!taoTestCenter/component/eligibilityEditor/layout","ui/feedback","ui/modal","css!taoTestCenterCss/eligibilityEditor"],function($,_,__,module,url,uri,component,GenerisTreeSelectClass,layoutTpl,feedback){"use strict";var _ns=".eligibility-editor",_modalDefaults={width:600},config={dataUrl:url.route(
"getData","GenerisTree","tao"),deliveriesOrder:"http://www.w3.org/2000/01/rdf-schema#label",deliveriesOrderdir:"asc",isDacEnabled:!1,testTakerDataUrl:url.route("getData","TestCenterManager","taoTestCenter")},config=_.defaults({},module.config(),config);_.isObject(config.testTakerDataUrl)?config.testTakerDataUrl=url.route(config.testTakerDataUrl.action,config.testTakerDataUrl.controller,config.testTakerDataUrl.extension):config.testTakerDataUrl=config.dataUrl;return function(){function buildTestTakerTree(id,url,testTakers,isDacEnabled){return testTakers=_.pluck(testTakers,"uri"),void 0===isDacEnabled&&(isDacEnabled=config.isDacEnabled),
new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(testTakers,uri.encode),serverParameters:{openParentNodes:testTakers,rootNode:"http://www.tao.lu/Ontologies/TAOSubject.rdf#Subject"},paginate:10,checkResourcePermissions:isDacEnabled})}function destroyModal(){eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().modal("destroy").remove()}function initModal(modalConfig){modalConfig=_.defaults(modalConfig||{},_modalDefaults),eligibilityEditor&&eligibilityEditor.getElement()&&eligibilityEditor.getElement().addClass("modal").on("closed.modal",destroyModal
).modal(modalConfig)}var testTakerTreeId=_.uniqueId("eligible-testTaker-tree-"),deliveryTreeId=_.uniqueId("eligible-delivery-tree-"),eligibilityEditor=component({add:function($container,options){return this.on("render",function(){var deliveryTree,testTakerTree,self=this;options=_.defaults(options||{},this.config),deliveryTree=function(id,url,deliveries){deliveries=_.pluck(deliveries,"uri");return new GenerisTreeSelectClass("#"+id,url,{actionId:"treeOptions.actionId",saveUrl:"treeOptions.saveUrl",saveData:{},checkedNodes:_.map(deliveries,uri.encode),serverParameters:{openParentNodes:deliveries,
rootNode:"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery",order:config.deliveriesOrder,orderdir:config.deliveriesOrderdir},paginate:10})}(deliveryTreeId,options.dataUrl),testTakerTree=buildTestTakerTree(testTakerTreeId,options.testTakerDataUrl,[],options.isDacEnabled),initModal({width:650}),this.$component.on("click"+_ns,".actions .done",function(e){var deliveries=_(deliveryTree.getChecked()).uniq().compact().value(),testTakers=_(testTakerTree.getChecked()).uniq().compact().value();deliveries&&deliveries.length?(self.trigger("ok",{deliveries:deliveries,testTakers:testTakers}),destroyModal()):feedback(self.$component).warning(__(
"At least one delivery need to be selected to create"))}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Add Eligibility"),editingMode:!1,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId}).render($container).resize()},edit:function($container,deliveryName,testTakers,options){return this.on("render",function(){var testTakerTree,self=this;options=_.defaults(options||{},this.config),testTakerTree=buildTestTakerTree(testTakerTreeId,options.testTakerDataUrl,testTakers,options.isDacEnabled),initModal({width:400}),this.$component.on("click"+_ns,
".actions .done",function(e){var testTakers=_(testTakerTree.getChecked()).uniq().compact().value();self.trigger("ok",{testTakers:testTakers}),destroyModal()}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Edit Eligibility"),editingMode:!0,subjectTreeId:testTakerTreeId,deliveryTreeId:deliveryTreeId,deliveryName:deliveryName}).render($container).resize()},resize:function(){return eligibilityEditor.getElement().css({top:"40px","overflow-y":"auto"}),eligibilityEditor.getElement().css("max-height",$(window).height()-2*parseInt(eligibilityEditor.getElement().css("top"
),10)+"px"),this}},config).setTemplate(layoutTpl);return eligibilityEditor}}),define("tpl!taoTestCenter/component/eligibilityTable/status",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];var helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression;return(Handlebars=helpers.if.call(depth0,depth0&&depth0.byPassProctor,{hash:{},inverse:this.program(3,function(depth0,data){var helper,buffer="";return buffer+='\n    <span class="icon-shield txt-success" title="'+escapeExpression((data={hash:{},data:data},(
helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"This delivery needs proctor authorization",data):helperMissing.call(depth0,"__","This delivery needs proctor authorization",data)))+'"></span>\n'},data=data||{}),fn:this.program(1,function(depth0,data){var helper,buffer="";return buffer+='\n    <span class="icon-unshield txt-danger" title="'+escapeExpression((data={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"This delivery can be launched without authorization",data):helperMissing.call(depth0,"__","This delivery can be launched without authorization",data)))+'"></span>\n'},data),data:data})
)||0===Handlebars?Handlebars:""})}),define("tpl!taoTestCenter/component/eligibilityTable/actions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"];var helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,self=this;function program2(depth0,data){var helper,options,buffer="";return buffer+='\n        <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Enable proctor authorization",options):helperMissing.call(depth0,"__",
"Enable proctor authorization",options)))+'" data-action="shield">\n            <span class="icon-shield"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Require authorization",options):helperMissing.call(depth0,"__","Require authorization",options)))+"\n        </button>\n    "}function program4(depth0,data){var helper,options,buffer="";return buffer+='\n        <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove proctor authorization",options):helperMissing.call(depth0,"__",
"Remove proctor authorization",options)))+'" data-action="unshield">\n            <span class="icon-unshield"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Monitor only",options):helperMissing.call(depth0,"__","Monitor only",options)))+"\n        </button>\n    "}return(Handlebars=helpers.if.call(depth0,depth0&&depth0.allowedToWrite,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n    <button class="btn-info small edit" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__
)?helper.call(depth0,"Edit eligibile test takers",options):helperMissing.call(depth0,"__","Edit eligibile test takers",options)))+'" data-action="edit">\n        <span class="icon-edit"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Edit",options):helperMissing.call(depth0,"__","Edit",options)))+"\n    </button>\n\n    ",!(stack1=helpers.if.call(depth0,depth0&&depth0.byPassProctor,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n\n    <button class="btn-info small remove" title="'+escapeExpression((options={
hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove eligibility",options):helperMissing.call(depth0,"__","Remove eligibility",options)))+'" data-action="remove">\n        <span class="icon-bin"></span> '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Remove",options):helperMissing.call(depth0,"__","Remove",options)))+"\n    </button>\n"},data=data||{}),data:data}))||0===Handlebars?Handlebars:""})}),define("css!taoTestCenterCss/eligibilityTable",[],function(){}),define("taoTestCenter/component/eligibilityTable",["jquery","lodash","i18n","ui/component","helpers",
"tpl!taoTestCenter/component/eligibilityTable/status","tpl!taoTestCenter/component/eligibilityTable/actions","css!taoTestCenterCss/eligibilityTable.css","ui/datatable"],function($,_,__,component,helpers,statusTpl,actionsTpl){"use strict";return function(testCenterId,permissions){var tableComponent,eligibilities=[],tools=[],allowedToWrite=!1;if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");return permissions&&!permissions.WRITE||(allowedToWrite=!0,tools=[{id:"add",icon:"add",title:__("Add"),label:__("Add"),action:function(){tableComponent.trigger("add",eligibilities)}},{id:"import",
icon:"import",title:__("Import"),label:__("Import"),action:function(){tableComponent.trigger("import",eligibilities)}}]),tableComponent=component({},{dataUrl:helpers._url("getEligibilities","TestCenterManager","taoTestCenter",{uri:testCenterId})}).on("render",function(){var self=this;this.$component.on("query.datatable",function(){self.trigger("loading")}).on("load.datatable",function(e){self.trigger("loaded")}).on("beforeload.datatable",function(e,dataSet){dataSet&&dataSet.data&&(eligibilities=dataSet.data)}).datatable({url:this.config.dataUrl,status:{empty:__("No Eligible Delivery yet"),available:__("Eligible Deliveries"),loading:__("Loading")},
tools:tools,model:[{id:"status",label:"",transform:function(value,row){return statusTpl(row)}},{id:"deliveryLabel",label:__("Delivery"),transform:function(value,row){return row.delivery.label}},{id:"testTakersCount",label:__("Eligible Test Takers"),transform:function(value,row){return row.testTakers&&row.testTakers.length?row.testTakers.length:0}},{id:"actions",label:__("Actions"),transform:function(value,row){return row.allowedToWrite=allowedToWrite,actionsTpl(row)}}],selectable:!1}).on("click",".actions button",function(e){e.preventDefault();var e=$(this),itemId=e.parents("[data-item-identifier]").data("item-identifier"),e=e.data("action");self.trigger(e,
itemId,eligibilities)})}).on("reload",function(){this.$component&&this.$component.datatable("refresh")})}}),define("tpl!taoTestCenter/component/eligibilityImport/layout",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var Handlebars="";return(Handlebars+='<div id="eligibility-import">\n    <div class="report-container">\n        <div class="section-header flex-container-full">\n            <h2>')+((0,this.escapeExpression)((Handlebars=helpers.title)||"function"==typeof(Handlebars=depth0&&depth0.title)?Handlebars.call(
depth0,{hash:{},data:data}):Handlebars)+'</h2>\n        </div>\n        <div class="main-container flex-container-full report"></div>\n    </div>\n    <div id="upload-container"></div>\n</div>')})}),define("taoTestCenter/component/eligibilityImport",["jquery","lodash","i18n","module","helpers","uri","ui/component","tpl!taoTestCenter/component/eligibilityImport/layout","ui/feedback","ui/report","layout/loading-bar","async","ui/modal","css!taoTestCenterCss/eligibilityEditor","ui/uploader"],function($,_,__,module,helpers,uri,component,layoutTpl,feedback,reportFactory,loadingBar,async){"use strict";var _ns=".eligibility-import",_fileTypeFilters=["text/csv",
"application/vnd.ms-excel"],_fileExtFilter=/.+\.(csv)$/,_modalDefaults={width:600};return function(datatable,testCenterId){var config={uploadUrl:helpers._url("import","TestCenterManager","taoTestCenter",{uri:testCenterId})};if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");var destroyModal=function(){eligibilityImport&&eligibilityImport.getElement()&&(datatable.trigger("reload"),eligibilityImport.getElement().modal("destroy").remove())};function initModal(modalConfig){var errors,$reportContainer;modalConfig=_.defaults(modalConfig||{},_modalDefaults),
eligibilityImport&&eligibilityImport.getElement()&&eligibilityImport.getElement().addClass("modal").on("closed.modal",destroyModal).modal(modalConfig),errors=[],modalConfig=$("#upload-container"),$reportContainer=$(".report-container"),modalConfig.on("upload.uploader",function(e,file,data){return reportFactory({actions:[{id:"continue",icon:"right",title:"continue",label:__("Continue")}]},data.report).on("action-continue",function(){destroyModal()}).render($reportContainer.find(".report"))}).on("fail.uploader",function(e,file,err){errors.push(__("Unable to upload file %s : %s",file.name,err))}).on("end.uploader",function(){0<errors.length&&feedback().error(
"<ul><li>"+errors.join("</li><li>")+"</li></ul>",{encodeHtml:!1}),errors=[]}),modalConfig.uploader({upload:!0,uploadUrl:config.uploadUrl,fileSelect:function(files,done){var givenLength=files.length;(files=_.filter(files,function(file){var checkType=file.type.replace(/("|')/g,"");return _.contains(_fileTypeFilters,checkType)||""===checkType&&_fileExtFilter.test(file.name)})).length!==givenLength&&feedback().error(__("Invalid files have been removed")),async.filter(files,function(file,cb){cb(!0)},done)}})}var eligibilityImport;return eligibilityImport=component({add:function($container,options){return this.on("render",function(){var self=this;
options=_.defaults(options||{},this.config),initModal({width:650}),this.$component.on("click"+_ns,".actions .done",function(e){e.preventDefault(),destroyModal()}).on("click"+_ns,".actions .cancel",function(e){e.preventDefault(),destroyModal(),self.trigger("cancel")}),this.trigger("open")}).init({title:__("Import Eligibilities from csv file."),editingMode:!1}).render($container).resize()},resize:function(){return eligibilityImport.getElement().css({top:"40px","overflow-y":"auto"}),eligibilityImport.getElement().css("max-height",$(window).height()-2*parseInt(eligibilityImport.getElement().css("top"),10)+"px"),this}},config).setTemplate(layoutTpl)}}),define(
"taoTestCenter/provider/eligibility",["jquery","lodash","helpers","core/promise"],function($,_,helpers,Promise){"use strict";function request(action,parameters){return $.ajax({url:helpers._url(action,"TestCenterManager","taoTestCenter"),data:parameters,dataType:"json",type:"POST"})}return function(testCenterId){if(_.isEmpty(testCenterId))throw new TypeError("The eligibility provider needs to be initialized with a test center");return{addEligibilities:function(eligibilities){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibilities))return reject(new TypeError("Invalid eligibility"));request("addEligibilities",{uri:testCenterId,
eligibility:eligibilities}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},editEligibility:function(eligibility){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibility))return reject(new TypeError("Invalid eligibility"));request("editEligibilities",{uri:testCenterId,eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},removeEligibility:function(eligibility){return new Promise(function(resolve,reject){if(!_.isPlainObject(eligibility))return reject(new TypeError("Invalid eligibility"));request("removeEligibilities",{uri:testCenterId,
eligibility:eligibility}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},shieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request("shieldEligibility",{uri:testCenterId,eligibility:eligibilityId}).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})},unshieldEligibility:function(eligibilityId){return new Promise(function(resolve,reject){_.isString(eligibilityId)||reject(new TypeError("Invalid eligibility")),request("unshieldEligibility",{uri:testCenterId,eligibility:eligibilityId}
).success(resolve).fail(function(xhr){return reject(new Error(xhr.responseText))})})}}}}),define("taoTestCenter/controller/TestCenterManager/editCenter",["jquery","lodash","i18n","layout/loading-bar","ui/feedback","taoTestCenter/component/eligibilityEditor","taoTestCenter/component/eligibilityTable","taoTestCenter/component/eligibilityImport","taoTestCenter/provider/eligibility"],function($,_,__,loadingBar,feedback,eligibilityEditorFactory,eligibilityTableFactory,eligibilityImportFactory,eligibilityProvider){"use strict";return{start:function(){function loading(){loadingBar.start()}function loaded(){loadingBar.stop()}function handleError(err){loaded(),
feedback().error(err.message)}function success(message){loaded(),feedback().success(message),eligibilityTable.trigger("reload")}var $container=$(".eligible-deliveries"),$tableContainer=$(".eligibility-table-container",$container),$editorContainer=$(".eligibility-editor-container",$container),$editorImportContainer=$(".eligibility-import-container",$container),testCenterId=$container.data("testcenter"),permissions=!1,eligibilityTable=($container.data("dacenabled")&&(permissions=$container.data("permissions")),eligibilityTableFactory(testCenterId,permissions).on("loading",loading).on("loaded",loaded).on("add",function(){var self=this;eligibilityEditorFactory(
).add($editorContainer).on("ok",function(eligibility){loading(),eligibilityProvider(testCenterId).addEligibilities(eligibility).then(function(response){loaded(),response.failed&&response.failed.length?feedback().warning(__("The following delivery(ies) are already eligible : ")+response.failed.join(", ")):feedback().success(__("New eligible delivery added")),self.trigger("reload")}).catch(handleError)})}).on("edit",function(eligibilityId,eligibilities){var eligibility=_.find(eligibilities,{uri:eligibilityId});eligibilityEditorFactory().edit($editorContainer,eligibility.delivery.label,eligibility.testTakers).on("ok",function(updated){loading(),
eligibilityProvider(testCenterId).editEligibility({deliveries:[eligibility.delivery.uri],testTakers:updated.testTakers}).then(function(response){success(__("Eligible test takers updated"))}).catch(handleError)})}).on("remove",function(eligibilityId,eligibilities){eligibilities=_.find(eligibilities,{uri:eligibilityId});loading(),eligibilityProvider(testCenterId).removeEligibility({deliveries:[eligibilities.delivery.uri]}).then(function(){success(__("Eligible delivery removed"))}).catch(handleError)}).on("shield",function(eligibilityId){loading(),eligibilityProvider(testCenterId).shieldEligibility(eligibilityId).then(function(){success(__(
"Eligibility needs proctor authorization"))}).catch(handleError)}).on("unshield",function(eligibilityId){loading(),eligibilityProvider(testCenterId).unshieldEligibility(eligibilityId).then(function(){success(__("Eligibility don't need proctor authorization any more."))}).catch(handleError)}).on("import",function(){eligibilityImportFactory(this,testCenterId).add($editorImportContainer)}).init({}).render($tableContainer))}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}(
".eligibility-editor h2.title{margin-top:0}.eligibility-editor .tree-container label{top:10px}.eligibility-editor .tree{border:none}.eligibility-editor .eligible-delivery{margin-left:0}.eligibility-editor.editing .eligible-delivery{display:none}.eligibility-editor.editing .eligible-testTaker{margin-left:0}.eligibility-editor.editing .eligible-testTaker .delivery-name{font-weight:bold}.eligibility-editor .actions{margin-top:20px}.eligibility-editor .actions .btn{float:right;margin-left:20px}.eligibility-editor .actions .btn.cancel{position:relative;top:3px}\n\n/*# sourceMappingURL=../../../taoTestCenter/views/css/eligibilityEditor.css.map */.eligible-deliveries th:last-child{text-align:center}.eligible-deliveries td.status{text-align:center;width:48px}.eligible-deliveries td.status>span{font-size:18px;font-size:1.8rem;vertical-align:bottom}\n\n/*# sourceMappingURL=../../../taoTestCenter/views/css/eligibilityTable.css.map */"
),define("taoTestCenter/loader/taoTestCenter.bundle",function(){}),define("taoTestCenter/loader/taoTestCenter.min",["taoProctoring/loader/taoProctoring.min"],function(){});
//# sourceMappingURL=taoTestCenter.min.js.map